{"ast":null,"code":"\"use strict\";\n/**\r\n * Copyright (c) \"Neo4j\"\r\n * Neo4j Sweden AB [http://neo4j.com]\r\n *\r\n * This file is part of Neo4j.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar neo4j_driver_core_1 = require(\"neo4j-driver-core\");\n\nvar bolt_protocol_v1_1 = __importDefault(require(\"./bolt-protocol-v1\"));\n\nvar bolt_protocol_v2_1 = __importDefault(require(\"./bolt-protocol-v2\"));\n\nvar bolt_protocol_v3_1 = __importDefault(require(\"./bolt-protocol-v3\"));\n\nvar bolt_protocol_v4x0_1 = __importDefault(require(\"./bolt-protocol-v4x0\"));\n\nvar bolt_protocol_v4x1_1 = __importDefault(require(\"./bolt-protocol-v4x1\"));\n\nvar bolt_protocol_v4x2_1 = __importDefault(require(\"./bolt-protocol-v4x2\"));\n\nvar bolt_protocol_v4x3_1 = __importDefault(require(\"./bolt-protocol-v4x3\"));\n\nvar bolt_protocol_v4x4_1 = __importDefault(require(\"./bolt-protocol-v4x4\"));\n\nvar response_handler_1 = __importDefault(require(\"./response-handler\"));\n/**\r\n * Creates a protocol with a given version\r\n *\r\n * @param {object} config\r\n * @param {number} config.version The version of the protocol\r\n * @param {channel} config.channel The channel\r\n * @param {Chunker} config.chunker The chunker\r\n * @param {Dechunker} config.dechunker The dechunker\r\n * @param {Logger} config.log The logger\r\n * @param {ResponseHandler~Observer} config.observer Observer\r\n * @param {boolean} config.disableLosslessIntegers Disable the lossless integers\r\n * @param {boolean} packstreamConfig.useBigInt if this connection should convert all received integers to native BigInt numbers.\r\n * @param {boolean} config.serversideRouting It's using server side routing\r\n */\n\n\nfunction create(_a) {\n  var _b = _a === void 0 ? {} : _a,\n      version = _b.version,\n      chunker = _b.chunker,\n      dechunker = _b.dechunker,\n      channel = _b.channel,\n      disableLosslessIntegers = _b.disableLosslessIntegers,\n      useBigInt = _b.useBigInt,\n      serversideRouting = _b.serversideRouting,\n      server = _b.server,\n      // server info\n  log = _b.log,\n      observer = _b.observer;\n\n  var createResponseHandler = function (protocol) {\n    var responseHandler = new response_handler_1.default({\n      transformMetadata: protocol.transformMetadata.bind(protocol),\n      log: log,\n      observer: observer\n    }); // reset the error handler to just handle errors and forget about the handshake promise\n\n    channel.onerror = observer.onError.bind(observer); // Ok, protocol running. Simply forward all messages to the dechunker\n\n    channel.onmessage = function (buf) {\n      return dechunker.write(buf);\n    }; // setup dechunker to dechunk messages and forward them to the message handler\n\n\n    dechunker.onmessage = function (buf) {\n      responseHandler.handleResponse(protocol.unpacker().unpack(buf));\n    };\n\n    return responseHandler;\n  };\n\n  return createProtocol(version, server, chunker, {\n    disableLosslessIntegers: disableLosslessIntegers,\n    useBigInt: useBigInt\n  }, serversideRouting, createResponseHandler, observer.onProtocolError.bind(observer), log);\n}\n\nexports.default = create;\n\nfunction createProtocol(version, server, chunker, packingConfig, serversideRouting, createResponseHandler, onProtocolError, log) {\n  switch (version) {\n    case 1:\n      return new bolt_protocol_v1_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError);\n\n    case 2:\n      return new bolt_protocol_v2_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError);\n\n    case 3:\n      return new bolt_protocol_v3_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError);\n\n    case 4.0:\n      return new bolt_protocol_v4x0_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError);\n\n    case 4.1:\n      return new bolt_protocol_v4x1_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError, serversideRouting);\n\n    case 4.2:\n      return new bolt_protocol_v4x2_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError, serversideRouting);\n\n    case 4.3:\n      return new bolt_protocol_v4x3_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError, serversideRouting);\n\n    case 4.4:\n      return new bolt_protocol_v4x4_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError, serversideRouting);\n\n    default:\n      throw (0, neo4j_driver_core_1.newError)('Unknown Bolt protocol version: ' + version);\n  }\n}","map":{"version":3,"sources":["D:/Documents/EMA/Mines A3/NoSQL/ReseauAchats/reseau_achats/node_modules/neo4j-driver-bolt-connection/lib/bolt/create.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","neo4j_driver_core_1","require","bolt_protocol_v1_1","bolt_protocol_v2_1","bolt_protocol_v3_1","bolt_protocol_v4x0_1","bolt_protocol_v4x1_1","bolt_protocol_v4x2_1","bolt_protocol_v4x3_1","bolt_protocol_v4x4_1","response_handler_1","create","_a","_b","version","chunker","dechunker","channel","disableLosslessIntegers","useBigInt","serversideRouting","server","log","observer","createResponseHandler","protocol","responseHandler","default","transformMetadata","bind","onerror","onError","onmessage","buf","write","handleResponse","unpacker","unpack","createProtocol","onProtocolError","packingConfig","newError"],"mappings":"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","sourcesContent":["\"use strict\";\r\n/**\r\n * Copyright (c) \"Neo4j\"\r\n * Neo4j Sweden AB [http://neo4j.com]\r\n *\r\n * This file is part of Neo4j.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar neo4j_driver_core_1 = require(\"neo4j-driver-core\");\r\nvar bolt_protocol_v1_1 = __importDefault(require(\"./bolt-protocol-v1\"));\r\nvar bolt_protocol_v2_1 = __importDefault(require(\"./bolt-protocol-v2\"));\r\nvar bolt_protocol_v3_1 = __importDefault(require(\"./bolt-protocol-v3\"));\r\nvar bolt_protocol_v4x0_1 = __importDefault(require(\"./bolt-protocol-v4x0\"));\r\nvar bolt_protocol_v4x1_1 = __importDefault(require(\"./bolt-protocol-v4x1\"));\r\nvar bolt_protocol_v4x2_1 = __importDefault(require(\"./bolt-protocol-v4x2\"));\r\nvar bolt_protocol_v4x3_1 = __importDefault(require(\"./bolt-protocol-v4x3\"));\r\nvar bolt_protocol_v4x4_1 = __importDefault(require(\"./bolt-protocol-v4x4\"));\r\nvar response_handler_1 = __importDefault(require(\"./response-handler\"));\r\n/**\r\n * Creates a protocol with a given version\r\n *\r\n * @param {object} config\r\n * @param {number} config.version The version of the protocol\r\n * @param {channel} config.channel The channel\r\n * @param {Chunker} config.chunker The chunker\r\n * @param {Dechunker} config.dechunker The dechunker\r\n * @param {Logger} config.log The logger\r\n * @param {ResponseHandler~Observer} config.observer Observer\r\n * @param {boolean} config.disableLosslessIntegers Disable the lossless integers\r\n * @param {boolean} packstreamConfig.useBigInt if this connection should convert all received integers to native BigInt numbers.\r\n * @param {boolean} config.serversideRouting It's using server side routing\r\n */\r\nfunction create(_a) {\r\n    var _b = _a === void 0 ? {} : _a, version = _b.version, chunker = _b.chunker, dechunker = _b.dechunker, channel = _b.channel, disableLosslessIntegers = _b.disableLosslessIntegers, useBigInt = _b.useBigInt, serversideRouting = _b.serversideRouting, server = _b.server, // server info\r\n    log = _b.log, observer = _b.observer;\r\n    var createResponseHandler = function (protocol) {\r\n        var responseHandler = new response_handler_1.default({\r\n            transformMetadata: protocol.transformMetadata.bind(protocol),\r\n            log: log,\r\n            observer: observer\r\n        });\r\n        // reset the error handler to just handle errors and forget about the handshake promise\r\n        channel.onerror = observer.onError.bind(observer);\r\n        // Ok, protocol running. Simply forward all messages to the dechunker\r\n        channel.onmessage = function (buf) { return dechunker.write(buf); };\r\n        // setup dechunker to dechunk messages and forward them to the message handler\r\n        dechunker.onmessage = function (buf) {\r\n            responseHandler.handleResponse(protocol.unpacker().unpack(buf));\r\n        };\r\n        return responseHandler;\r\n    };\r\n    return createProtocol(version, server, chunker, { disableLosslessIntegers: disableLosslessIntegers, useBigInt: useBigInt }, serversideRouting, createResponseHandler, observer.onProtocolError.bind(observer), log);\r\n}\r\nexports.default = create;\r\nfunction createProtocol(version, server, chunker, packingConfig, serversideRouting, createResponseHandler, onProtocolError, log) {\r\n    switch (version) {\r\n        case 1:\r\n            return new bolt_protocol_v1_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError);\r\n        case 2:\r\n            return new bolt_protocol_v2_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError);\r\n        case 3:\r\n            return new bolt_protocol_v3_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError);\r\n        case 4.0:\r\n            return new bolt_protocol_v4x0_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError);\r\n        case 4.1:\r\n            return new bolt_protocol_v4x1_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError, serversideRouting);\r\n        case 4.2:\r\n            return new bolt_protocol_v4x2_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError, serversideRouting);\r\n        case 4.3:\r\n            return new bolt_protocol_v4x3_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError, serversideRouting);\r\n        case 4.4:\r\n            return new bolt_protocol_v4x4_1.default(server, chunker, packingConfig, createResponseHandler, log, onProtocolError, serversideRouting);\r\n        default:\r\n            throw (0, neo4j_driver_core_1.newError)('Unknown Bolt protocol version: ' + version);\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"script"}